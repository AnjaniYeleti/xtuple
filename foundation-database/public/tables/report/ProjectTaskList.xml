<!DOCTYPE openRPTDef>
<report>
 <title>ProjectTaskList</title>
 <name>ProjectTaskList</name>
 <description></description>
 <parameter listtype="static" type="integer" active="true" default="10" name="prj_id">
  <description></description>
 </parameter>
 <grid>
  <snap/>
  <show/>
  <x>0.05</x>
  <y>0.05</y>
 </grid>
 <size>Letter</size>
 <portrait/>
 <topmargin>50</topmargin>
 <bottommargin>50</bottommargin>
 <rightmargin>50</rightmargin>
 <leftmargin>50</leftmargin>
 <querysource>
  <name>detail</name>
  <sql>  WITH RECURSIVE task_hier AS (
     SELECT task_id, task_number, task_parent_task_id, 1 AS level, ARRAY[task_id] AS path_info
     FROM task 
     WHERE task_parent_task_id IS NULL
       AND task_prj_id=&lt;?value("prj_id")?>
     UNION ALL
     SELECT c.task_id, rpad(' ', p.level * 2) || c.task_number, c.task_parent_task_id, p.level + 1, p.path_info||c.task_id
     FROM task c
      JOIN task_hier p ON c.task_parent_task_id = p.task_id
     WHERE task_prj_id=&lt;?value("prj_id")?>
  )
  SELECT t.task_id, h.task_number ||'-'||task_name AS task_name, 
       t.task_descrip,
       CASE                       
           WHEN task_status = 'C' THEN &lt;? value('complete') ?>
           WHEN task_status = 'O' THEN &lt;? value('inprocess') ?>
           WHEN task_status = 'P' THEN &lt;? value('planning') ?>
           WHEN task_status = 'N' THEN &lt;? value('new') ?>
           WHEN task_status = 'D' THEN &lt;? value('deferred') ?>
       END AS status,
       formatDate(task_due_date) AS f_due,
       formatDate((SELECT MIN(taskass_assigned_date) FROM taskass WHERE taskass_task_id=t.task_id)) AS f_assigned,
       formatDate(task_start_date) AS f_start,
       formatDate(task_completed_date) AS f_completed,
       path_info
  FROM task_hier h
  JOIN task t ON t.task_id=h.task_id
  WHERE (task_parent_id = &lt;?value("prj_id")?> AND task_parent_type='J')
  ORDER BY path_info</sql>
 </querysource>
 <querysource>
  <name>head</name>
  <sql>SELECT (prj_number||'-'||prj_name) AS project
  FROM prj
 WHERE (prj_id=&lt;? value("prj_id") ?>);</sql>
 </querysource>
 <rpthead>
  <height>102</height>
  <label>
   <rect>
    <x>10</x>
    <y>50</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Project:</string>
  </label>
  <field>
   <rect>
    <x>70</x>
    <y>50</y>
    <width>450</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>head</query>
    <column>project</column>
   </data>
  </field>
  <label>
   <rect>
    <x>265</x>
    <y>80</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Description</string>
  </label>
  <label>
   <rect>
    <x>15</x>
    <y>80</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Name</string>
  </label>
  <line>
   <xstart>5</xstart>
   <ystart>95</ystart>
   <xend>745</xend>
   <yend>95</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>295</x>
    <y>10</y>
    <width>450</width>
    <height>38</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>18</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Project Task List</string>
  </label>
 </rpthead>
 <section>
  <name>detail</name>
  <detail>
   <key>
    <query>detail</query>
   </key>
   <height>43</height>
   <field>
    <rect>
     <x>70</x>
     <y>18</y>
     <width>70</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_start</column>
    </data>
   </field>
   <field>
    <rect>
     <x>225</x>
     <y>18</y>
     <width>70</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_assigned</column>
    </data>
   </field>
   <field>
    <rect>
     <x>375</x>
     <y>18</y>
     <width>70</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_due</column>
    </data>
   </field>
   <field>
    <rect>
     <x>525</x>
     <y>18</y>
     <width>70</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>f_completed</column>
    </data>
   </field>
   <label>
    <rect>
     <x>460</x>
     <y>18</y>
     <width>60</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>normal</weight>
    </font>
    <right/>
    <vcenter/>
    <string>Completed:</string>
   </label>
   <label>
    <rect>
     <x>5</x>
     <y>18</y>
     <width>60</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>normal</weight>
    </font>
    <right/>
    <vcenter/>
    <string>Start Date:</string>
   </label>
   <label>
    <rect>
     <x>310</x>
     <y>18</y>
     <width>60</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>normal</weight>
    </font>
    <right/>
    <vcenter/>
    <string>Due Date:</string>
   </label>
   <label>
    <rect>
     <x>160</x>
     <y>18</y>
     <width>60</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>normal</weight>
    </font>
    <right/>
    <vcenter/>
    <string>Assigned:</string>
   </label>
   <field>
    <rect>
     <x>655</x>
     <y>18</y>
     <width>95</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <right/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>status</column>
    </data>
   </field>
   <label>
    <rect>
     <x>605</x>
     <y>18</y>
     <width>45</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>normal</weight>
    </font>
    <right/>
    <vcenter/>
    <string>Status:</string>
   </label>
   <field>
    <rect>
     <x>15</x>
     <y>-2</y>
     <width>245</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>task_name</column>
    </data>
   </field>
   <field>
    <rect>
     <x>270</x>
     <y>-2</y>
     <width>475</width>
     <height>20</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <vcenter/>
    <data>
     <query>detail</query>
     <column>prjtask_descrip</column>
    </data>
   </field>
  </detail>
 </section>
 <pgfoot>
  <height>18</height>
  <label>
   <rect>
    <x>615</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Page:</string>
  </label>
  <label>
   <rect>
    <x>5</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Report Date:</string>
  </label>
  <field>
   <rect>
    <x>705</x>
    <y>0</y>
    <width>40</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>page_number</column>
   </data>
  </field>
  <field>
   <rect>
    <x>95</x>
    <y>0</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>report_date</column>
   </data>
  </field>
 </pgfoot>
</report>
